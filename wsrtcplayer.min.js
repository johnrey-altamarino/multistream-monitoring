!function i(o,n,s){function a(t,e){if(!n[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(_)return _(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=n[t]={exports:{}},o[t][0].call(r.exports,function(e){return a(o[t][1][e]||e)},r,r.exports,i,o,n,s)}return n[t].exports}for(var _="function"==typeof require&&require,e=0;e<s.length;e++)a(s[e]);return a}({1:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;class i{}i.rootDefaultConfig={reportUrl:"http://tracker.p2p.8686c.com/report",cdcUrl:"http://transit1.wslog.chinanetcenter.com/message/queue/msg_push_binary?topic=wsrtcdata&msg_key=",cdcUrlBk:"http://transit2.wslog.chinanetcenter.com/message/queue/msg_push_binary?topic=wsrtcdata&msg_key=",confUrl:"http://www.vod.lxdns.com/p2p/webrtc/bjweimiao/wsrtcConf.json",cdcDisable:0,reportIntervalTime:6e4,eventIntervalTime:1e4,reportDisable:0,confIntervalTime:6e5,confTimeout:8e3,reportTimeout:8e3,version:"v.3.0.5-1_h"},r.default=i},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var i,o=e("./simple-loader"),n=(i=e("./_WsBaseConf"))&&i.__esModule?i:{default:i};e("./common");r.default=class{constructor(e,t){this._confXhr=void 0,this._confInterval=void 0,this._url=e,this._eventCb=t,this._conf={},Object.assign(this._conf,n.default.rootDefaultConfig)}start(){this.stop(),this._confGet(),this._confInterval||(this._confInterval=setInterval(this._confGet.bind(this),this._conf.confIntervalTime))}stop(){this._confInterval&&(clearInterval(this._confInterval),this._confInterval=void 0)}destory(){this.stop()}getConf(){return this._conf}_confGet(){this._onConfComplete(),this._confXhr=new o._WSRangeSimpleLoader("GET",this._conf.confTimeout),this._confXhr.__onDataArrival=this._onConfResponse.bind(this),this._confXhr.__onComplete=this._onConfComplete.bind(this),this._confXhr.__onError=this._onConfComplete.bind(this);var e={url:this._url};this._confXhr.__open(e,1,2,1)}_onConfComplete(){null!=this._confXhr&&(this._confXhr.__onDataArrival=void 0,this._confXhr.__onComplete=void 0,this._confXhr.__onError=void 0,this._confXhr.__destroy(),this._confXhr=void 0)}_onConfResponse(e,t){t<=0||(null!=(t=JSON.parse(e)).commonConf.disable_cdc_log&&(this._conf.cdcDisable=t.commonConf.disable_cdc_log),null!=t.commonConf.report_url&&(this._conf.reportUrl=t.commonConf.report_url),null!=t.commonConf.p2pdatabox_url&&(this._conf.cdcUrl=t.commonConf.p2pdatabox_url),null!=t.commonConf.p2pdatabox_urlbk&&(this._conf.cdcUrlBk=t.commonConf.p2pdatabox_urlbk),null!=t.commonConf.disable_portal_log_report&&(this._conf.reportDisable=t.commonConf.disable_portal_log_report),null!=t.commonConf.conf_timeout&&(this._conf.confTimeout=t.commonConf.conf_timeout),null!=t.commonConf.http_log_timetout&&(this._conf.reportTimeout=t.commonConf.http_log_timetout),null!=t.commonConf.update_conf_interval&&this._conf.confIntervalTime!=1e3*t.commonConf.update_conf_interval&&(this._conf.confIntervalTime=1e3*t.commonConf.update_conf_interval,this._confStop(),this._confInterval=setInterval(this._confGet.bind(this),this._conf.confIntervalTime)),null!=t.commonConf.periodic_log_interval&&(this._conf.reportIntervalTime=1e3*t.commonConf.periodic_log_interval),null!=t.commonConf.event_log_interval&&(this._conf.eventIntervalTime=1e3*t.commonConf.event_log_interval),this._eventCb&&null!=this._eventCb&&this._eventCb(this._conf))}}},{"./_WsBaseConf":1,"./common":6,"./simple-loader":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._WsPlayerEventCode=r._WsNotifyCode=r._WsEventCode=void 0;r._WsNotifyCode={WsNotifyBufferEnd:0,WsNotifyBufferStart:1,WsNotifySDPResponse:2,WsNotifyClose:3},r._WsEventCode={WsSDPConnect:"WsSDPConnect",WsSDPFailed:"WsSDPFailed",WsConnecting:"WsConnecting",WsConnectSuccess:"WsConnectSuccess"};r._WsPlayerEventCode={WsOpen:"WsOpen",WsClose:"WsClose"}},{}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.createWsRTCPlayer=function(e){return new h(e)};var i=d(e("./_WsConf.js")),o=d(e("./_WsReporter.js")),n=d(e("./_WsBaseConf.js")),s=e("./simple-loader"),a=e("./common"),_=e("./_WsEventCode");function d(e){return e&&e.__esModule?e:{default:e}}const l={UnConnected:"unConnected",Connected:"connected"};var c=0;class h{constructor(e){if(null==e||"object"!=typeof e)throw new InvalidArgumentException("option must be an javascript object!");if(!e.element)throw new InvalidArgumentException("option must has type field to indicate element!");this._customerID=e.customerID||"unkown",this._element=e.element,this._listener=e.listener,this._pc=void 0,this._intervalValue,this._connectedStatus=l.UnConnected,this._xhr=void 0,this._isOpened=!1,this._waitCheck=void 0,this._waitCheckLastTime=void 0,this._waitStatus=0,this._conf={},this._playerID=c++,this._onMediaLoadedMetadataHdl=this._onMediaLoadedMetadata.bind(this),Object.assign(this._conf,n.default.rootDefaultConfig)}destory(){(0,a.trace)("player destory : "+this._url+"playerID:"+this._playerID),this.close(),this._wsReporter&&(this._wsReporter.destory(),this._wsReporter=null),this._wsConfCtrl&&(this._wsConfCtrl.destory(),this._wsConfCtrl=null),this._customerID=null,this._element=null,this._url=null}open(e){var t;(0,a.trace)("player open : "+e+"playerID:"+this._playerID),this._isOpened||(this._isOpened=!0,this._waitStatus=0,-1==e.indexOf(".sdp")&&(-1==(t=e.indexOf("?"))?e+=".sdp":e=e.substr(0,t)+".sdp"+e.substr(t)),this._url=e,this._wsConfCtrl&&this._wsConfCtrl.destory(),t="http://www.vod.lxdns.com/p2p/webrtc/{customerID}/wsrtcConf.json".replace("{customerID}",this._customerID),this._wsConfCtrl=new i.default(t,this._configEventCB.bind(this)),this._wsConfCtrl.start(),this._wsReporter&&this._wsReporter.destory(),this._wsReporter=new o.default(e,this._element,this._conf),this._wsReporter.start(),this._wsReporter.eventAdd(_._WsPlayerEventCode.WsOpen),this._startWebrtc(),this._startWaitingCheck())}close(){(0,a.trace)("player close : "+this._url+"playerID:"+this._playerID),this._isOpened&&(this._isOpened=!1,this._connectedStatus=l.UnConnected,this._intervalValue&&(clearInterval(this._intervalValue),this._intervalValue=void 0),this._stopWaitingCheck(),this._stopWebrtc(),this._wsReporter&&(this._wsReporter.eventAdd(_._WsPlayerEventCode.WsClose),this._wsReporter.stop()),this._wsConfCtrl&&this._wsConfCtrl.stop(),null!=arguments[0]&&this._listener&&this._listener(_._WsNotifyCode.WsNotifyClose,arguments[0]))}_startWebrtc(){this._pc&&this._pc.close(),this._pc=new RTCPeerConnection({sdpSemantics:"unified-plan"}),this._pc.addTransceiver("audio",{direction:"recvonly"}),this._pc.addTransceiver("video",{direction:"recvonly"}),this._pc.onicecandidate=function(e){this._onIceCandidate(this._pc,e)}.bind(this),this._pc.oniceconnectionstatechange=function(e){this._onIceStateChange(this._pc,e)}.bind(this),this._pc.stream=new MediaStream,this._element.srcObject=this._pc.stream,this._pc.ontrack=this._gotRemoteStream.bind(this),this._pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){(0,a.trace)("createOffer:\n"+e.sdp),0<navigator.userAgent.toLowerCase().indexOf("firefox")&&(t=e.sdp.split("\r\n").map(function(e){return e.includes("a=fmtp:111")?e+";stereo=1":e}).join("\r\n"),e.sdp=this._modifySDP(t)),(0,a.trace)("createOffer: modify \n"+e.sdp),this._pc.setLocalDescription(e);var t=this._url,e={version:"v1.0",sessionId:"sessionid_test",localSdp:e},t=(this._onComplete(),this._xhr=new s._WSRangeSimpleLoader("POST"),this._xhr.__onDataArrival=function(e,t){t<=0||(200!=(t=JSON.parse(e)).code?((0,a.trace)("play failed, code:"+t.code),this._wsReporter.intervalAdd(_._WsEventCode.WsSDPFailed),this.close("res code error:"+t.code)):(e=t.remoteSdp,(0,a.trace)("receive answer:\n"+e.sdp),this._pc.setRemoteDescription(new RTCSessionDescription(e),function(){(0,a.trace)("setRemoteDescription success!"),this._wsReporter.intervalAdd(_._WsEventCode.WsConnecting)}.bind(this),function(e){(0,a.trace)("setRemoteDescription failed, message:"+e.message),this._wsReporter.intervalAdd(_._WsEventCode.WsSDPFailed),this.close("setRemoteDescription:"+e.message)}),this._listener&&this._listener(_._WsNotifyCode.WsNotifySDPResponse,e.sdp)))}.bind(this),this._xhr.__onComplete=this._onComplete.bind(this),this._xhr.__onError=function(){this._wsReporter.intervalAdd(_._WsEventCode.WsSDPFailed),this._onComplete(),this.close()}.bind(this),{url:t});this._xhr.__open(t,3,1,1,JSON.stringify(e)),this._wsReporter.intervalAdd(_._WsEventCode.WsSDPConnect)}.bind(this)).catch(function(e){(0,a.trace)("create offer failed, reason:"+e)})}_stopWebrtc(){this._pc&&(this._pc.close(),this._pc=null),this._element&&(this._element.srcObject=null)}_startWaitingCheck(){(0,a.trace)("addEventListener "+this+"playerID:"+this._playerID),this._element&&this._element.addEventListener("loadedmetadata",this._onMediaLoadedMetadataHdl),(0,a.trace)("addEventListener1 "+this+"playerID:"+this._playerID)}_stopWaitingCheck(){(0,a.trace)("removeEventListener "+this+"playerID:"+this._playerID),this._element&&this._element.removeEventListener("loadedmetadata",this._onMediaLoadedMetadataHdl),(0,a.trace)("removeEventListener 1"+this),this._waitCheck&&(clearInterval(this._waitCheck),this._waitCheck=void 0,this._waitCheckLastTime=void 0,this._waitStatus=0)}_onMediaLoadedMetadata(){(0,a.trace)("_onMediaLoadedMetadata "+this+"playerID:"+this._playerID),this._wsReporter.setFirstShowTime(Date.now().toFixed(0)),this._waitCheck||(this._waitCheck=setInterval(this._waitingCheck.bind(this),500),this._waitCheckLastTime=this._element.currentTime,this._waitStatus=0)}_waitingCheck(){var e=this._element.currentTime;this._waitCheckLastTime>=e?0==this._waitStatus&&(this._wsReporter.addBufferTime(1),this._waitStatus=1,this._listener&&this._listener(_._WsNotifyCode.WsNotifyBufferStart)):(1==this._waitStatus&&this._listener&&this._listener(_._WsNotifyCode.WsNotifyBufferEnd),this._waitStatus=0),this._waitCheckLastTime=e}_onIceCandidate(e,t){(0,a.trace)("ICE candidate: \n"+(t.candidate?t.candidate.candidate:"(null)"))}_onIceStateChange(e,t){e&&(l.UnConnected==this._connectedStatus&&"connected"==e.iceConnectionState?(this._connectedStatus=l.Connected,this._wsReporter.intervalAdd(_._WsEventCode.WsConnectSuccess),this._intervalValue||(this._intervalValue=setInterval(this._getStats.bind(this),2e3))):"disconnected"==e.iceConnectionState&&this.close("disconnected"),(0,a.trace)("ICE state: "+e.iceConnectionState),(0,a.trace)("ICE state change event: ",t))}_gotRemoteStream(e){(0,a.trace)("ontrack, kind:"+e.track.kind),this._pc.stream.addTrack(e.track)}_getStats(){this._pc&&this._pc.getStats().then(this._onStats.bind(this))}_onStats(e){var t=this;e.forEach(function(e){"inbound-rtp"===e.type&&t._wsReporter.intervalRtc(e)})}_onComplete(){null!=this._xhr&&(this._xhr.__onComplete=void 0,this._xhr.__onError=void 0,this._xhr.__destroy(),this._xhr=void 0)}_configEventCB(e){Object.assign(this._conf,e),this._wsReporter&&(this._wsReporter.updateEventInterval(this._conf.eventIntervalTime),this._wsReporter.updateReportInterval(this._conf.reportIntervalTime))}_modifySDP(e){var e=e.split("\r\n"),r=[],t=[],i=(e.forEach(function(e){var t=e.toLowerCase();t.includes("a=rtpmap")&&t.includes("h264")&&r.push(e)}),1<r.length&&t.push.apply(t,function(e,t){for(var r=0,i=t.length,o=e.length;r<i;r++,o++)e[o]=t[r];return e}([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,o,n=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=n.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}(r.slice(1)))),t.map(function(e){e=/a=rtpmap:(\d+)\s/.exec(e);return e&&1<e.length?e[1]:null}).filter(function(e){return null!==e})),o=[];return e.forEach(function(e){var t=e;if(e.includes("a=setup")&&(t="a=setup:passive"),(e.includes("m=audio")||e.includes("m=video"))&&(t=e.split(" ").filter(function(e,t){return t<3||!i.includes(e)}).join(" ")),e.includes("a=fmtp")||e.includes("a=rtcp-fb")||e.includes("a=rtpmap")){e=/a=(?:fmtp|rtcp-fb|rtpmap):(\d+)\s/.exec(e);if(e&&1<e.length&&i.includes(e[1]))return}o.push(t)}),o.join("\r\n")}}},{"./_WsBaseConf.js":1,"./_WsConf.js":2,"./_WsEventCode":3,"./_WsReporter.js":5,"./common":6,"./simple-loader":15}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=e("./simple-loader"),i=e("./sha256"),a=e("./md5"),o=e("./env"),n=e("./_WsEventCode"),_=e("./common");function d(e){return e||"-"}r.default=class{constructor(e,t,r){this._reportInterval=void 0,this._reportEvent=void 0,this._reportIntervalValue=new Object,this._reportIntervalRtcTmp=new Object,this._reportEventValue=new Object,this._startTime=void 0,this._playerId=void 0,this._mediaEle=t,this._firstShowTime=void 0,this._sysInfo=(0,o.getEnv)().browser,this._waitCheck=void 0,this._waitCheckLastTime=void 0,this._waitStatus=0,this._streamUrl=e,this._reportDisable=!1,this._cdcDisable=!1,this._reportTimeout=8e3,this._conf=r,this._isStarted=!1,this._reportIntervalTime=r.reportIntervalTime,this._eventIntervalTime=r.eventIntervalTime}destory(){}start(){(0,_.trace)("report start"),this._isStart&&stop(),this._isStarted=!0,this._reportIntervalInit(),this._reportIntervalValue.render_times=1;var e=Date.now().toFixed(0),e=Number(e).toString(16);this._playerId=(0,i.sha256_digest)(e+performance.now()+Math.random()+this._streamUrl),this._startTime=Date.now().toFixed(0),this._reportIntervalRtcInit(),this._reportEventValue=new Object,this._reportInterval||(this._reportInterval=setInterval(this._reportProcess.bind(this),this._reportIntervalTime)),this._reportEvent||(this._reportEvent=setInterval(this._eventProcess.bind(this),this._eventIntervalTime))}stop(){(0,_.trace)("report stop"),this._isStarted&&(this._isStarted=!1,this._reportInterval&&(clearInterval(this._reportInterval),this._reportInterval=void 0,this._reportProcess()),this._reportEvent&&(clearInterval(this._reportEvent),this._reportEvent=void 0,this._eventProcess()),this._startTime=void 0,this._playerId=void 0,this._firstShowTime=void 0)}setUrl(e){this._streamUrl=e}setFirstShowTime(e){this._firstShowTime=e-this._startTime,this._reportIntervalValue.first_show_time=this._firstShowTime}addBufferTime(e){this._reportIntervalValue.buffer_times+=e}updateEventInterval(e){this._eventIntervalTime!=e&&(this._eventIntervalTime=1e3<e?e:1e3,this._eventInterval&&clearInterval(this._eventInterval),this._startTime&&(this._eventInterval=setInterval(this._eventProcess.bind(this),this._eventIntervalTime)))}updateReportInterval(e){this._reportIntervalTime!=e&&(this._reportIntervalTime=1e4<e?e:1e4,this._reportInterval&&clearInterval(this._reportInterval),this._startTime&&(this._reportInterval=setInterval(this._reportProcess.bind(this),this._reportIntervalTime)))}eventAdd(e){var t=Date.now().toFixed(0);n._WsPlayerEventCode.WsOpen==e?this._reportEventValue[t]=1:n._WsPlayerEventCode.WsClose==e&&(this._reportEventValue[t]=2)}intervalAdd(e){switch(e){case n._WsEventCode.WsSDPConnect:this._reportIntervalValue.sdp_conn_times+=1;break;case n._WsEventCode.WsSDPFailed:this._reportIntervalValue.sdp_fail+=1;break;case n._WsEventCode.WsConnecting:this._reportIntervalValue.connect_times+=1;break;case n._WsEventCode.WsConnectSuccess:this._reportIntervalValue.connect_succ+=1}}intervalRtcStats(){var e;arguments.length<=0||("audio"==(e=arguments[0]).kind?(this._reportIntervalValue.audio_recv_bytes+=e.bytesReceived-this._reportIntervalRtcTmp.audio_recv_bytes,this._reportIntervalRtcTmp.audio_recv_bytes=e.bytesReceived,this._reportIntervalValue.audio_lost+=e.packetsLost-this._reportIntervalRtcTmp.audio_lost,this._reportIntervalRtcTmp.audio_lost=e.packetsLost):"video"==e.kind&&(this._reportIntervalValue.video_recv_bytes+=e.bytesReceived-this._reportIntervalRtcTmp.video_recv_bytes,this._reportIntervalRtcTmp.video_recv_bytes=e.bytesReceived,this._reportIntervalValue.video_frame_received+=e.framesReceived-this._reportIntervalRtcTmp.video_frame_received,this._reportIntervalRtcTmp.video_frame_received=e.framesReceived,this._reportIntervalValue.video_frame_decoded+=e.framesDecoded-this._reportIntervalRtcTmp.video_frame_decoded,this._reportIntervalRtcTmp.video_frame_decoded=e.framesDecoded,this._reportIntervalValue.video_frame_droped+=e.framesDropped-this._reportIntervalRtcTmp.video_frame_droped,this._reportIntervalRtcTmp.video_frame_droped=e.framesDropped,this._reportIntervalValue.video_lost+=e.packetsLost-this._reportIntervalRtcTmp.video_lost,this._reportIntervalRtcTmp.video_lost=e.packetsLost))}intervalRtc(){var e,t,r;arguments.length<=0||(this.intervalRtcStats(arguments[0]),"audio"==(e=arguments[0]).mediaType?(null==e.googJitterBufferMs||null==e.googCurrentDelayMs?(r=0<(t=parseInt(e.jitterBufferEmittedCount)/1e3||0)?(parseInt(e.jitterBufferDelay)||0)/t:0,this._reportIntervalValue.audio_jitter_delay+=r,this._reportIntervalRtcTmp.audio_jitter_delay_cnt+=1,this._reportIntervalValue.audio_delay_time+=r):(this._reportIntervalValue.audio_jitter_delay+=e.googJitterBufferMs,this._reportIntervalRtcTmp.audio_jitter_delay_cnt+=1,this._reportIntervalValue.audio_delay_time+=e.googCurrentDelayMs),this._reportIntervalRtcTmp.audio_delay_cnt+=1):"video"==e.mediaType&&(null==e.googJitterBufferMs||e.googTargetDelayMs?(r=0<(t=parseInt(e.jitterBufferEmittedCount)/1e3||0)?(parseInt(e.jitterBufferDelay)||0)/t:0,this._reportIntervalValue.video_jitter_delay+=r,this._reportIntervalRtcTmp.video_jitter_delay_cnt+=1,this._reportIntervalValue.delay_time+=r):(this._reportIntervalValue.video_jitter_delay+=e.googJitterBufferMs,this._reportIntervalRtcTmp.video_jitter_delay_cnt+=1,this._reportIntervalValue.delay_time+=e.googTargetDelayMs),this._reportIntervalRtcTmp.delay_cnt+=1))}_reportIntervalInit(){this._reportIntervalValue.first_show_time=0,this._reportIntervalValue.sdp_conn_times=0,this._reportIntervalValue.sdp_fail=0,this._reportIntervalValue.connect_succ=0,this._reportIntervalValue.connect_times=0,this._reportIntervalValue.buffer_times=0,this._reportIntervalValue.delay_time=0,this._reportIntervalValue.video_recv_bytes=0,this._reportIntervalValue.audio_recv_bytes=0,this._reportIntervalValue.video_read_num=0,this._reportIntervalValue.audio_read_num=0,this._reportIntervalValue.render_times=0,this._reportIntervalValue.video_first_pkt_delay=0,this._reportIntervalValue.video_first_frame_delay=0,this._reportIntervalValue.video_jitter_delay=0,this._reportIntervalValue.video_frame_received=0,this._reportIntervalValue.video_frame_decoded=0,this._reportIntervalValue.video_frame_droped=0,this._reportIntervalValue.video_render_drop=0,this._reportIntervalValue.audio_first_pkt_delay=0,this._reportIntervalValue.audio_delay_time=0,this._reportIntervalValue.audio_jitter_delay=0,this._reportIntervalValue.audio_lost=0,this._reportIntervalValue.video_lost=0}_reportIntervalRtcInit(){this._reportIntervalRtcTmp.delay_time=0,this._reportIntervalRtcTmp.video_recv_bytes=0,this._reportIntervalRtcTmp.audio_recv_bytes=0,this._reportIntervalRtcTmp.video_read_num=0,this._reportIntervalRtcTmp.audio_read_num=0,this._reportIntervalRtcTmp.video_first_pkt_delay=0,this._reportIntervalRtcTmp.video_first_frame_delay=0,this._reportIntervalRtcTmp.video_jitter_delay=0,this._reportIntervalRtcTmp.video_frame_received=0,this._reportIntervalRtcTmp.video_frame_decoded=0,this._reportIntervalRtcTmp.video_frame_droped=0,this._reportIntervalRtcTmp.video_render_drop=0,this._reportIntervalRtcTmp.audio_first_pkt_delay=0,this._reportIntervalRtcTmp.audio_delay_time=0,this._reportIntervalRtcTmp.audio_lost=0,this._reportIntervalRtcTmp.video_lost=0,this._reportIntervalRtcTmp.audio_jitter_delay_cnt=0,this._reportIntervalRtcTmp.audio_delay_cnt=0,this._reportIntervalRtcTmp.video_jitter_delay_cnt=0,this._reportIntervalRtcTmp.delay_cnt=0}_reportProcess(){var e,t,r,i,o,n;this._reportIntervalValue.audio_jitter_delay=0<this._reportIntervalRtcTmp.audio_jitter_delay_cnt?(this._reportIntervalValue.audio_jitter_delay/this._reportIntervalRtcTmp.audio_jitter_delay_cnt).toFixed(0):this._reportIntervalValue.audio_jitter_delay,this._reportIntervalValue.audio_delay_time=0<this._reportIntervalRtcTmp.audio_delay_cnt?(this._reportIntervalValue.audio_delay_time/this._reportIntervalRtcTmp.audio_delay_cnt).toFixed(0):this._reportIntervalValue.audio_delay_time,this._reportIntervalValue.video_jitter_delay=0<this._reportIntervalRtcTmp.video_jitter_delay_cnt?(this._reportIntervalValue.video_jitter_delay/this._reportIntervalRtcTmp.video_jitter_delay_cnt).toFixed(0):this._reportIntervalValue.video_jitter_delay,this._reportIntervalValue.delay_time=0<this._reportIntervalRtcTmp.delay_cnt?(this._reportIntervalValue.delay_time/this._reportIntervalRtcTmp.delay_cnt).toFixed(0):this._reportIntervalValue.delay_time,this._conf.reportDisable||(n=new Object,e=new Object,this._reportCommon(n),this._reportIntervalFormat(this._reportIntervalValue,e),n.events=new Array,n.events.push(e),e=JSON.stringify(n),(0,_.trace)("_reportProcess reporter:"+e),this._onInterComplete(),this._interXhr=new s._WSRangeSimpleLoader("POST",this._conf.reportTimeout),this._interXhr.__onComplete=this._onInterComplete.bind(this),this._interXhr.__onError=this._onInterComplete.bind(this),n={url:this._conf.reportUrl},this._interXhr.__open(n,3,2,1,this._reportEncry(e))),this._conf.cdcDisable||(e=this._reportCdc(this._reportIntervalValue),(0,_.trace)("_reportProcess cdcStr:"+e),o=Math.round(Date.now()*(Math.random()+Math.random())/1e3).toString(16),t=Math.round(performance.now()).toString(16),r=Math.round(performance.now()*Math.random()*Math.random()*1e3).toString(16),i=Math.round((Date.now()/1e3+performance.now())*Math.random()).toString(16),o=(0,a.md5)(o+"-"+t+"-"+r+"-"+i+Date.now()),this._onCdcComplete(),this._cdcXhr=new s._WSRangeSimpleLoader("POST",this._conf.reportTimeout),this._cdcXhr.__onComplete=this._onCdcComplete.bind(this),this._cdcXhr.__onError=this._onCdcComplete.bind(this),n={url:this._conf.cdcUrl+o},this._cdcXhr.__open(n,3,2,1,this._reportEncry(e))),this._reportIntervalInit(),this._reportIntervalRtcTmp.audio_jitter_delay_cnt=0,this._reportIntervalRtcTmp.audio_delay_cnt=0,this._reportIntervalRtcTmp.video_jitter_delay_cnt=0,this._reportIntervalRtcTmp.delay_cnt=0}_eventProcess(){if(!(this._conf.reportDisable||Object.keys(this._reportEventValue).length<=0)){var e,t=new Object,r=(t.events=new Array,this._reportCommon(t),this._streamUrl.indexOf("?"));for(e in this._reportEventValue){var i=new Object;i.event_time_msec=e,i.ws0017=1==this._reportEventValue[e]?"open":"close",i.url=-1==r?this._streamUrl:this._streamUrl.substr(0,r),i.player_id=d(this._playerId),t.events.push(i)}var o=JSON.stringify(t),n=(this._onEventComplete(),this._eventXhr=new s._WSRangeSimpleLoader("POST",this._conf.reportTimeout),this._eventXhr.__onComplete=this._onEventComplete.bind(this),this._eventXhr.__onError=this._onEventComplete.bind(this),{url:this._conf.reportUrl});this._eventXhr.__open(n,3,2,1,this._reportEncry(o)),this._reportEventValue=void 0,this._reportEventValue=new Object}}_reportEncry(){if(!(arguments.length<1)){for(var e="wsPFVLive",t=arguments[0],r=t.length,i=new Uint8Array(r),o="",n=0;n<r;++n)i[n]=t.charCodeAt(n)^e.charCodeAt(n%e.length),o+=String.fromCharCode(i[n]);return i=null,o}}_reportCommon(){var e;arguments.length<1||((e=arguments[0]).eventCommon=new Object,e.eventCommon.Time=(Date.now()/1e3).toFixed(0),e.eventCommon.sType="rtc_player",e.eventCommon.ver=this._version,e.eventCommon.cid="bjweimiao",e.eventCommon.did=this._playerId,e.eventCommon.pTime=Date.now().toFixed(0)-this._startTime,e.eventCommon.sysinfo=this._sysInfo,e.eventCommon.platform="h5_rtc")}_reportIntervalFormat(){if(!(arguments.length<2)){var e,t=arguments[0],r=arguments[1];for(e in t)"audio_lost"!=e&&"video_lost"!=e&&(r[e]=t[e]);r.audio_lost=new Object,r.audio_lost.L0=t.audio_lost,r.audio_lost.L1=0,r.audio_lost.L2=0,r.audio_lost.L3=0,r.audio_lost.L4=0,r.video_lost=new Object,r.video_lost.L0=t.video_lost,r.video_lost.L1=0,r.video_lost.L2=0,r.video_lost.L3=0,r.video_lost.L4=0,r.eventTime=(Date.now()/1e3).toFixed(0),r.ws0017="play_interval",r.url=this._streamUrl,r.playerId=this._playerId}}_reportCdc(){var e,t;if(!(arguments.length<1))return e=arguments[0],t=(Date.now()/1e3).toFixed(0)+"\t",(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t+="bjweimiao\t")+d(this._playerId)+"\t")+d(this._playerId)+"\th5\t")+"rtc_player\t"+this._conf.version+"\t")+(Date.now().toFixed(0)-this._startTime)+"\t")+d(this._streamUrl)+"\t")+this._reportGetDomain(this._streamUrl)+"\t")+e.first_show_time+"\t")+e.sdp_fail+"\t")+e.sdp_conn_times+"\t")+e.connect_succ+"\t")+e.connect_times+"\t")+e.buffer_times+"\t")+e.delay_time+"\t")+e.audio_delay_time+"\t")+e.video_recv_bytes+"\t")+e.audio_recv_bytes+"\t")+e.render_times+"\t")+e.video_first_pkt_delay+"\t")+e.audio_first_pkt_delay+"\t")+e.video_first_frame_delay+"\t")+e.video_jitter_delay+"\t")+e.audio_jitter_delay}_reportGetDomain(){if(!arguments[0])return"-";var e=arguments[0],t=-1==(t=e.indexOf("://"))?0:t+3,r=e.indexOf("/",t);return-1==r?e.substr(t):e.substr(t,r-t)}_onInterComplete(e,t){null!=this._interXhr&&(this._interXhr.__onComplete=void 0,this._interXhr.__onError=void 0,this._interXhr.__destroy(),this._interXhr=void 0)}_onCdcComplete(e,t){null!=this._cdcXhr&&(this._cdcXhr.__onComplete=void 0,this._cdcXhr.__onError=void 0,this._cdcXhr.__destroy(),this._cdcXhr=void 0)}_onEventComplete(e,t){null!=this._eventXhr&&(this._eventXhr.__onComplete=void 0,this._eventXhr.__onError=void 0,this._eventXhr.__destroy(),this._eventXhr=void 0)}}},{"./_WsEventCode":3,"./common":6,"./env":7,"./md5":11,"./sha256":14,"./simple-loader":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.trace=function(e){var t=(window.performance.now()/1e3).toFixed(3);console.log(t+": ",e)}},{}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getEnv=function(){let e=function(){var e=navigator.userAgent.toLowerCase(),t=[],r="",i="",o="";{var n,s;0<=e.indexOf("wxwork")?i=0<=e.indexOf("android")?(s=/chrome\/[\d.]+/gi,r="wxwork chrome",""+e.match(s)):(r=0<=e.indexOf("iphone")?(n=/wxwork\/[\d.]+/gi,"wxwork iphone"):(n=/wxwork\/[\d.]+/gi,"wxwork"),""+e.match(n)):0<e.indexOf("micromessenger")?i=0<=e.indexOf("android")?(s=/chrome\/[\d.]+/gi,r="wechat chrome",""+e.match(s)):(r=0<=e.indexOf("iphone")?(n=/micromessenger\/[\d.]+/gi,"wechat iphone"):(n=/micromessenger\/[\d.]+/gi,"wechat"),""+e.match(n)):0<e.indexOf("dingtalk")?i=0<=e.indexOf("android")?(s=/chrome\/[\d.]+/gi,r="dingtalk chrome",""+e.match(s)):(r=0<=e.indexOf("iphone")?(n=/\(dingtalk\/[\d.]+/gi,"dingtalk iphone"):(n=/\(dingtalk\/[\d.]+/gi,"dingtalk"),""+e.match(n)):0<e.indexOf("msie")?(r="IE",i=""+e.match(/msie [\d.]+;/gi)):0<e.indexOf("firefox")?(r="firefox",i=""+e.match(/firefox\/[\d.]+/gi)):0<e.indexOf("chrome")?(s=/chrome\/[\d.]+/gi,r="chrome",i=""+e.match(s)):0<e.indexOf("safari")&&e.indexOf("chrome")<0?(r="safari",i=""+e.match(/version\/[\d.]+/gi)):0<=e.indexOf("opera")?(r="opera",i=""+e.match(/version\/[\d.]+/gi)):e.match(/(ipad|iphone|ipod)/i)&&e.match(/applewebkit/i)?(i=""+e.match(/applewebkit\/[\d.]+/gi),r="iPad|iPhone|iPod AppleWebKit"):(navigator.appName,i="unknown")}return o=(i+"").replace(/[^0-9.]/gi,""),t.push(r),t.push(o),t}(),t=function(){var e=navigator.userAgent.toLowerCase();return{isIE6:/msie 6.0/.test(e),isIE7:/msie 7.0/.test(e),isIE8:/msie 8.0/.test(e),isIE9:/msie 9.0/.test(e),isIE10:/msie 10.0/.test(e),isIE11:/msie 11.0/.test(e),isLB:/lbbrowser/.test(e),isUc:/ucweb/.test(e)||/ ubrowser/.test(e),is360:/360se/.test(e),isBaidu:/bidubrowser/.test(e)||/baidubrowser/.test(e),isSougou:/metasr/.test(e),isChrome:/chrome/.test(e.substr(-33,6))||/chrome/.test(e.substr(-34,6)),isFirefox:/firefox/.test(e),isOpera:/opera/.test(e),isSafire:/safari/.test(e)&&!/chrome/.test(e),isQQ:/qqbrowser/.test(e),isWxwork:/wxwork/.test(e),isMicroM:/micromessenger/.test(e),isDingT:/dingtalk/.test(e)}}(),r=function(){var e={win:!1,mac:!1,xll:!1,iphone:!1,ipod:!1,ipad:!1,ios:!1,android:!1,nokiaN:!1,winMobile:!1,wii:!1,ps:!1},t=navigator.userAgent,r=navigator.platform;if(e.win=0==r.indexOf("Win"),e.mac=0==r.indexOf("Mac"),e.xll=0==r.indexOf("Xll")||0==r.indexOf("Linux"),e.win&&/Win(?:dows )?([^do]{2})\s?(\d+\.\d+)?/.test(t))if("NT"==RegExp.$1)switch(RegExp.$2){case"5.0":e.win="2000";break;case"5.1":e.win="XP";break;case"6.0":e.win="Vista";break;case"6.1":e.win="7";break;case"6.2":e.win="8";break;case"10.0":e.win="10";break;default:e.win="NT"}else"9x"==RegExp.$1?e.win="ME":e.win=RegExp.$1;e.iphone=-1<t.indexOf("iPhone"),e.ipod=-1<t.indexOf("iPod"),e.ipad=-1<t.indexOf("iPad"),e.nokiaN=-1<t.indexOf("nokiaN"),"CE"==e.win?e.winMobile=e.win:"Ph"==e.win&&/Windows Phone OS (\d+.\d)/i.test(t)&&(e.win="Phone",e.winMobile=parseFloat(RegExp.$1));e.mac&&-1<t.indexOf("Mobile")&&(/CPU (?:iPhone )?OS (\d+_\d+)/i.test(t)?e.ios=parseFloat(RegExp.$1.replace("_",".")):e.ios=2);(/Android (\d+\.\d+)/i.test(t)||/android (\d+\.\d+)/i.test(t))&&(e.android=parseFloat(RegExp.$1));return e.wii=-1<t.indexOf("Wii"),e.ps=/PlayStation/i.test(t),e}(),i="browser ";t.isWxwork?i+="WxWork":t.isMicroM?i+="WeChat":t.isDingT?i+="DingTalk":t.isChrome?i+="Chrome":t.isFirefox?i+="Firefox":t.isOpera?i+="Opera":t.isSafire?i+="Safire":t.isUc?i+="UC":t.is360?i+="360":t.isQQ?i+="QQ":t.isBaidu?i+="Baidu":t.isSougou?i+="Sougou":t.isLB?i+="LieBao":t.isIE11?i+="IE11":t.isIE10?i+="IE10":t.isIE9?i+="IE9":t.isIE8?i+="IE8":t.isIE7?i+="IE7":t.isIE6?i+="IE6":i+="unknow";i+=", core "+e[0]+" "+e[1];let o="";o=0!=r.win?"Win "+r.win:0!=r.mac?"Mac":0!=r.iphone?"iPhone":0!=r.android?"Android":0!=r.xll?"Linux":0!=r.ipod?"iPod":0!=r.ipad?"iPad":0!=r.ios?"ios "+r.ios:0!=r.nokiaN?"nokiaN":0!=r.winMobile?"win Mobile":0!=r.wii?"Wii":0!=r.ps?"Play Station":"unknow sys";return{browser:i,sys:o}}},{}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RuntimeException=r.NotImplementedException=r.InvalidArgumentException=r.IllegalStateException=void 0;class i{constructor(e){this._message=e}get name(){return"RuntimeException"}get message(){return this._message}toString(){return this.name+": "+this.message}}(class extends(r.RuntimeException=i){});r.IllegalStateException=class extends i{constructor(e){super(e)}get name(){return"IllegalStateException"}};r.InvalidArgumentException=class extends i{constructor(e){super(e)}get name(){return"InvalidArgumentException"}};r.NotImplementedException=class extends i{constructor(e){super(e)}get name(){return"NotImplementedException"}}},{}],9:[function(t,e,r){window.wsrtcplayer={},window.wsrtcplayer.play=t("./play.js").play,window.wsrtcplayer.stop=t("./play.js").stop,window.wsrtcplayer.createWSRTCPlayer=t("./_WsRTCPlayer.js").createWsRTCPlayer,window.wsrtcplayer.NotifyCode=t("./_WsEventCode.js")._WsNotifyCode,Object.defineProperty(window.wsrtcplayer,"callback",{set:function(e){t("./play.js").setCallback(e)}})},{"./_WsEventCode.js":3,"./_WsRTCPlayer.js":4,"./play.js":12}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._WSBaseLoader=r.LoaderStatus=r.LoaderErrors=void 0;var i=e("./exception");const o={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};r.LoaderStatus=o;r.LoaderErrors={OK:"OK",EXCEPTION:"EXCEPTION",HTTP_STATUS_CODE_INVALID:"HTTP_STATUS_CODE_INVALID",CONNECTING_TIMEOUT:"CONNECTING_TIMEOUT",EARLY_EOF:"EARLY_EOF",ERROR_EARLY_EOF:"ERROR_EARLY_EOF"};r._WSBaseLoader=class{constructor(e){this._type=e||"undefined",this._status=o.kIdle,this._onDataArrival=null,this._onError=null,this._onComplete=null,this._onRetry=null}__destroy(){this._status=o.kIdle,this._onDataArrival=null,this._onError=null,this._onComplete=null,this._onRetry=null}__isWorking(){return!(this._status===o.kComplete||this._status===o.kIdle)}set __onDataArrival(e){this._onDataArrival=e}set __onError(e){this._onError=e}set __onComplete(e){this._onComplete=e}set __onRetry(e){this._onRetry=e}set __onFirstResult(e){this._onFirstResult=e}__open(e){throw new i.NotImplementedException("function must be defined")}__abort(){throw new i.NotImplementedException("function must be defined")}}},{"./exception":8}],11:[function(e,t,r){"use strict";function a(e,t){return e<<t|e>>>32-t}function h(e,t){var r=2147483648&e,i=2147483648&t,o=1073741824&e,n=1073741824&t,e=(1073741823&e)+(1073741823&t);return o&n?2147483648^e^r^i:o|n?1073741824&e?3221225472^e^r^i:1073741824^e^r^i:e^r^i}function p(e,t,r,i,o,n,s){return e=h(e,h(h(t&r|~t&i,o),s)),h(a(e,n),t)}function u(e,t,r,i,o,n,s){return e=h(e,h(h(t&i|r&~i,o),s)),h(a(e,n),t)}function v(e,t,r,i,o,n,s){return e=h(e,h(h(t^r^i,o),s)),h(a(e,n),t)}function m(e,t,r,i,o,n,s){return e=h(e,h(h(r^(t|~i),o),s)),h(a(e,n),t)}function f(e){for(var t="",r="",i=0;i<=3;i++)t+=(r="0"+(e>>>8*i&255).toString(16)).substr(r.length-2,2);return t}Object.defineProperty(r,"__esModule",{value:!0}),r.md5=function(e){var t,r,i,o,n,s,a,_,d,l=Array();for(e=function(e){for(var t="",r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t+=String.fromCharCode(i):t=127<i&&i<2048?(t+=String.fromCharCode(i>>6|192))+String.fromCharCode(63&i|128):(t=(t+=String.fromCharCode(i>>12|224))+String.fromCharCode(i>>6&63|128))+String.fromCharCode(63&i|128)}return t}(e),l=function(e){var t,r=e.length,i=r+8,i=16*((i-i%64)/64+1),o=Array(i-1),n=0,s=0;for(;s<r;)n=s%4*8,o[t=(s-s%4)/4]=o[t]|e.charCodeAt(s)<<n,s++;return n=s%4*8,o[t=(s-s%4)/4]=o[t]|128<<n,o[i-2]=r<<3,o[i-1]=r>>>29,o}(e),s=1732584193,a=4023233417,_=2562383102,d=271733878,t=0;t<l.length;t+=16)s=p(r=s,i=a,o=_,n=d,l[t+0],7,3614090360),d=p(d,s,a,_,l[t+1],12,3905402710),_=p(_,d,s,a,l[t+2],17,606105819),a=p(a,_,d,s,l[t+3],22,3250441966),s=p(s,a,_,d,l[t+4],7,4118548399),d=p(d,s,a,_,l[t+5],12,1200080426),_=p(_,d,s,a,l[t+6],17,2821735955),a=p(a,_,d,s,l[t+7],22,4249261313),s=p(s,a,_,d,l[t+8],7,1770035416),d=p(d,s,a,_,l[t+9],12,2336552879),_=p(_,d,s,a,l[t+10],17,4294925233),a=p(a,_,d,s,l[t+11],22,2304563134),s=p(s,a,_,d,l[t+12],7,1804603682),d=p(d,s,a,_,l[t+13],12,4254626195),_=p(_,d,s,a,l[t+14],17,2792965006),a=p(a,_,d,s,l[t+15],22,1236535329),s=u(s,a,_,d,l[t+1],5,4129170786),d=u(d,s,a,_,l[t+6],9,3225465664),_=u(_,d,s,a,l[t+11],14,643717713),a=u(a,_,d,s,l[t+0],20,3921069994),s=u(s,a,_,d,l[t+5],5,3593408605),d=u(d,s,a,_,l[t+10],9,38016083),_=u(_,d,s,a,l[t+15],14,3634488961),a=u(a,_,d,s,l[t+4],20,3889429448),s=u(s,a,_,d,l[t+9],5,568446438),d=u(d,s,a,_,l[t+14],9,3275163606),_=u(_,d,s,a,l[t+3],14,4107603335),a=u(a,_,d,s,l[t+8],20,1163531501),s=u(s,a,_,d,l[t+13],5,2850285829),d=u(d,s,a,_,l[t+2],9,4243563512),_=u(_,d,s,a,l[t+7],14,1735328473),a=u(a,_,d,s,l[t+12],20,2368359562),s=v(s,a,_,d,l[t+5],4,4294588738),d=v(d,s,a,_,l[t+8],11,2272392833),_=v(_,d,s,a,l[t+11],16,1839030562),a=v(a,_,d,s,l[t+14],23,4259657740),s=v(s,a,_,d,l[t+1],4,2763975236),d=v(d,s,a,_,l[t+4],11,1272893353),_=v(_,d,s,a,l[t+7],16,4139469664),a=v(a,_,d,s,l[t+10],23,3200236656),s=v(s,a,_,d,l[t+13],4,681279174),d=v(d,s,a,_,l[t+0],11,3936430074),_=v(_,d,s,a,l[t+3],16,3572445317),a=v(a,_,d,s,l[t+6],23,76029189),s=v(s,a,_,d,l[t+9],4,3654602809),d=v(d,s,a,_,l[t+12],11,3873151461),_=v(_,d,s,a,l[t+15],16,530742520),a=v(a,_,d,s,l[t+2],23,3299628645),s=m(s,a,_,d,l[t+0],6,4096336452),d=m(d,s,a,_,l[t+7],10,1126891415),_=m(_,d,s,a,l[t+14],15,2878612391),a=m(a,_,d,s,l[t+5],21,4237533241),s=m(s,a,_,d,l[t+12],6,1700485571),d=m(d,s,a,_,l[t+3],10,2399980690),_=m(_,d,s,a,l[t+10],15,4293915773),a=m(a,_,d,s,l[t+1],21,2240044497),s=m(s,a,_,d,l[t+8],6,1873313359),d=m(d,s,a,_,l[t+15],10,4264355552),_=m(_,d,s,a,l[t+6],15,2734768916),a=m(a,_,d,s,l[t+13],21,1309151649),s=m(s,a,_,d,l[t+4],6,4149444226),d=m(d,s,a,_,l[t+11],10,3174756917),_=m(_,d,s,a,l[t+2],15,718787259),a=m(a,_,d,s,l[t+9],21,3951481745),s=h(s,r),a=h(a,i),_=h(_,o),d=h(d,n);var c=f(s)+f(a)+f(_)+f(d);return e=l=d=_=a=s=null,c.toLowerCase()}},{}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.play=function(s,e){var t;n||((0,a.ConfStart)(),(0,d.trace)("Start play: "+s),(0,a.ReportStart)(s,e),(0,a.ReportEventAdd)(1),-1==(t=s.indexOf(".sdp"))&&(-1==(t=s.indexOf("?"))?s+=".sdp":s=s.substr(0,t)+".sdp"+s.substr(t)),(l=new RTCPeerConnection({sdpSemantics:"unified-plan"})).addTransceiver("audio",{direction:"recvonly"}),l.addTransceiver("video",{direction:"recvonly"}),l.onicecandidate=function(e){e=e,(0,d.trace)("ICE candidate: \n"+(e.candidate?e.candidate.candidate:"(null)"))},l.oniceconnectionstatechange=function(e){var t;e=e,(t=l)&&(0==o&&"connected"==t.iceConnectionState?(o=1,(0,a.ReportIntervalAdd)(4),i=i||setInterval(v,2e3)):"disconnected"==t.iceConnectionState&&u(),(0,d.trace)("ICE state: "+t.iceConnectionState),(0,d.trace)("ICE state change event: ",e))},l.stream=new MediaStream,e.srcObject=l.stream,l.ontrack=m,n=!0,l.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){(0,d.trace)("createOffer:\n"+e.sdp),0<navigator.userAgent.toLowerCase().indexOf("firefox")&&(n=e.sdp.split("\r\n").map(function(e){return e.includes("a=fmtp:111")?e+";stereo=1":e}).join("\r\n"),e.sdp=(n=(n=n).split("\r\n"),r=[],t=[],n.forEach(function(e){var t=e.toLowerCase();t.includes("a=rtpmap")&&t.includes("h264")&&r.push(e)}),1<r.length&&t.push.apply(t,function(e,t){for(var r=0,i=t.length,o=e.length;r<i;r++,o++)e[o]=t[r];return e}([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var i,o,n=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(i=n.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return s}(r.slice(1)))),i=t.map(function(e){e=/a=rtpmap:(\d+)\s/.exec(e);return e&&1<e.length?e[1]:null}).filter(function(e){return null!==e}),o=[],n.forEach(function(e){var t=e;if(e.includes("a=setup")&&(t="a=setup:passive"),(e.includes("m=audio")||e.includes("m=video"))&&(t=e.split(" ").filter(function(e,t){return t<3||!i.includes(e)}).join(" ")),e.includes("a=fmtp")||e.includes("a=rtcp-fb")||e.includes("a=rtpmap")){e=/a=(?:fmtp|rtcp-fb|rtpmap):(\d+)\s/.exec(e);if(e&&1<e.length&&i.includes(e[1]))return}o.push(t)}),o.join("\r\n"))),(0,d.trace)("createOffer: modify \n"+e.sdp),l.setLocalDescription(e);var r,i,o,t=s,n={version:"v1.0",sessionId:"sessionid_test",localSdp:e},e=(p(),(c=new _._WSRangeSimpleLoader("POST")).__onDataArrival=function(e,t){t<=0||(200!=(t=JSON.parse(e)).code?((0,d.trace)("play failed, code:"+t.code),(0,a.ReportIntervalAdd)(2),u()):(e=t.remoteSdp,(0,d.trace)("receive answer:\n"+e.sdp),l.setRemoteDescription(new RTCSessionDescription(e),function(){(0,d.trace)("setRemoteDescription success!"),(0,a.ReportIntervalAdd)(3)},function(e){(0,d.trace)("setRemoteDescription failed, message:"+e.message)}),h&&h(2,e.sdp)))},c.__onComplete=p,c.__onError=function(){(0,a.ReportIntervalAdd)(2),p(),u()},{url:t});c.__open(e,3,1,1,JSON.stringify(n)),(0,a.ReportIntervalAdd)(1)}).catch(function(e){(0,d.trace)("create offer failed, reason:"+e)}))},r.setCallback=function(e){h=e,(0,a.SetCb)(e)},r.stop=u;var i,a=e("./report"),_=e("./simple-loader"),d=e("./common"),l=void 0,o=0,c=void 0,h=void 0,n=!1;function p(){null!=c&&(c.__onComplete=void 0,c.__onError=void 0,c.__destroy(),c=void 0)}function u(){(0,d.trace)("Stop play"),n&&((0,a.SetCb)(void 0),h=void 0,i&&(clearInterval(i),i=void 0),l&&l.close(),(l=void 0,a.ReportEventAdd)(2),(0,a.ReportStop)(),o=0,n=!1)}function v(){l&&l.getStats().then(s)}function s(e){e.forEach(function(e){"inbound-rtp"===e.type&&(0,a.ReportIntervalRtc)(e)})}function m(e){(0,d.trace)("ontrack, kind:"+e.track.kind),l.stream.addTrack(e.track),2==l.stream.getTracks().length&&(0,d.trace)("Received remote stream complete")}},{"./common":6,"./report":13,"./simple-loader":15}],13:[function(e,V,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfStart=function(){q(),v(),p=p||setInterval(v,o)},t.ReportEventAdd=function(e){var t=Date.now().toFixed(0);1==e?w[t]=1:2==e&&(w[t]=2)},t.ReportIntervalAdd=function(e){switch(e){case 1:I.sdp_conn_times+=1;break;case 2:I.sdp_fail+=1;break;case 3:I.connect_times+=1;break;case 4:I.connect_succ+=1}},t.ReportIntervalRtc=function(){var e;arguments.length<=0||("audio"==(e=arguments[0]).kind?(I.audio_recv_bytes+=e.bytesReceived-C.audio_recv_bytes,C.audio_recv_bytes=e.bytesReceived,I.audio_lost+=e.packetsLost-C.audio_lost,C.audio_lost=e.packetsLost):"video"==e.kind&&(I.video_recv_bytes+=e.bytesReceived-C.video_recv_bytes,C.video_recv_bytes=e.bytesReceived,I.video_frame_received+=e.framesReceived-C.video_frame_received,C.video_frame_received=e.framesReceived,I.video_frame_decoded+=e.framesDecoded-C.video_frame_decoded,C.video_frame_decoded=e.framesDecoded,I.video_frame_droped+=e.framesDropped-C.video_frame_droped,C.video_frame_droped=e.framesDropped,I.video_lost+=e.packetsLost-C.video_lost,C.video_lost=e.packetsLost))},t.ReportIntervalRtcStats=function(){var e;arguments.length<=0||("audio"==(e=arguments[0]).stat("mediaType")?(I.audio_jitter_delay+=parseInt(e.stat("googJitterBufferMs")),C.audio_jitter_delay_cnt+=1,I.audio_delay_time+=parseInt(e.stat("googCurrentDelayMs")),C.audio_delay_cnt+=1):"video"==e.stat("mediaType")&&(I.video_jitter_delay+=parseInt(e.stat("googJitterBufferMs")),C.video_jitter_delay_cnt+=1,I.delay_time+=parseInt(e.stat("googTargetDelayMs")),C.delay_cnt+=1))},t.ReportStart=function(e,t){Q(),I.render_times=1,T=t,!b&&T&&T.addEventListener("loadedmetadata",H);t=Date.now().toFixed(0),t=Number(t).toString(16);R=(0,A.sha256_digest)(t+performance.now()+Math.random()+e),g=e,b=Date.now().toFixed(0),x=(0,N.getEnv)().browser,C.delay_time=0,C.video_recv_bytes=0,C.audio_recv_bytes=0,C.video_read_num=0,C.audio_read_num=0,C.video_first_pkt_delay=0,C.video_first_frame_delay=0,C.video_jitter_delay=0,C.video_frame_received=0,C.video_frame_decoded=0,C.video_frame_droped=0,C.video_render_drop=0,C.audio_first_pkt_delay=0,C.audio_delay_time=0,C.audio_lost=0,C.video_lost=0,C.audio_jitter_delay_cnt=0,C.audio_delay_cnt=0,C.video_jitter_delay_cnt=0,C.delay_cnt=0,w=new Object,f=f||setInterval(j,r),y=y||setInterval(K,i)},t.ReportStop=function(){S&&(clearInterval(S),S=void 0,O=void 0,L=0),f&&(clearInterval(f),f=void 0),y&&(clearInterval(y),y=void 0),j(),K(),g=void 0,b=void 0,R=void 0,E=void 0,x=void 0,T&&T.removeEventListener("loadedmetadata",H),T=void 0},t.SetCb=function(e){u=e};var a=e("./simple-loader"),A=e("./sha256"),M=e("./md5"),N=e("./env"),_="http://tracker.p2p.8686c.com/report",F="http://transit1.wslog.chinanetcenter.com/message/queue/msg_push_binary?topic=wsrtcdata&msg_key=",U="http://www.vod.lxdns.com/p2p/webrtc/bjweimiao/wsrtcConf.json",X=0,r=6e4,i=1e4,d=0,o=6e5,B=8e3,l=8e3,J="v.3.0.3_h",n=void 0,s=void 0,c=void 0,h=void 0,p=void 0,u=void 0;function q(){p&&(clearInterval(p),p=void 0)}function v(){m(),(n=new a._WSRangeSimpleLoader("GET",B)).__onDataArrival=G,n.__onComplete=m,n.__onError=m,n.__open({url:U},1,2,1)}function m(){null!=n&&(n.__onDataArrival=void 0,n.__onComplete=void 0,n.__onError=void 0,n.__destroy(),n=void 0)}function G(e,t){t<=0||(null!=(t=JSON.parse(e)).commonConf.disable_cdc_log&&(X=t.commonConf.disable_cdc_log),null!=t.commonConf.report_url&&(_=t.commonConf.report_url),null!=t.commonConf.p2pdatabox_url&&(F=t.commonConf.p2pdatabox_url),null!=t.commonConf.p2pdatabox_urlbk&&t.commonConf.p2pdatabox_urlbk,null!=t.commonConf.disable_portal_log_report&&(d=t.commonConf.disable_portal_log_report),null!=t.commonConf.conf_timeout&&(B=t.commonConf.conf_timeout),null!=t.commonConf.http_log_timetout&&(l=t.commonConf.http_log_timetout),null!=t.commonConf.update_conf_interval&&o!=1e3*t.commonConf.update_conf_interval&&(o=1e3*t.commonConf.update_conf_interval,q(),p=setInterval(v,o)),null!=t.commonConf.periodic_log_interval&&r!=1e3*t.commonConf.periodic_log_interval&&(r=1e3*t.commonConf.periodic_log_interval,f&&clearInterval(f),b&&(f=setInterval(j,r))),null!=t.commonConf.event_log_interval&&i!=1e3*t.commonConf.event_log_interval&&(i=1e3*t.commonConf.event_log_interval,y&&clearInterval(y),b&&(y=setInterval(K,i))))}var f=void 0,y=void 0,I=new Object,C=new Object,w=void 0,g=void 0,b=void 0,R=void 0,T=void 0,E=void 0,x=void 0,S=void 0,O=void 0,L=0;function H(){E=Date.now().toFixed(0)-b,I.first_show_time=E,S||(S=setInterval($,500),O=T.currentTime,L=0)}function $(){var e;E&&T&&((e=T.currentTime)<=O?0==L&&(I.buffer_times+=1,L=1,u&&u(1)):(1==L&&u&&u(0),L=0),O=e)}function Q(){I.first_show_time=0,I.sdp_conn_times=0,I.sdp_fail=0,I.connect_succ=0,I.connect_times=0,I.buffer_times=0,I.delay_time=0,I.video_recv_bytes=0,I.audio_recv_bytes=0,I.video_read_num=0,I.audio_read_num=0,I.render_times=0,I.video_first_pkt_delay=0,I.video_first_frame_delay=0,I.video_jitter_delay=0,I.video_frame_received=0,I.video_frame_decoded=0,I.video_frame_droped=0,I.video_render_drop=0,I.audio_first_pkt_delay=0,I.audio_delay_time=0,I.audio_jitter_delay=0,I.audio_lost=0,I.video_lost=0}function k(){null!=c&&(c.__onComplete=void 0,c.__onError=void 0,c.__destroy(),c=void 0)}function D(){null!=s&&(s.__onComplete=void 0,s.__onError=void 0,s.__destroy(),s=void 0)}function j(){var e,t,r,i,o,n;I.audio_jitter_delay=0<C.audio_jitter_delay_cnt?(I.audio_jitter_delay/C.audio_jitter_delay_cnt).toFixed(0):I.audio_jitter_delay,I.audio_delay_time=0<C.audio_delay_cnt?(I.audio_delay_time/C.audio_delay_cnt).toFixed(0):I.audio_delay_time,I.video_jitter_delay=0<C.video_jitter_delay_cnt?(I.video_jitter_delay/C.video_jitter_delay_cnt).toFixed(0):I.video_jitter_delay,I.delay_time=0<C.delay_cnt?(I.delay_time/C.delay_cnt).toFixed(0):I.delay_time,d||(n=new Object,e=new Object,Y(n),function(){if(!(arguments.length<2)){var e,t=arguments[0],r=arguments[1];for(e in t)"audio_lost"!=e&&"video_lost"!=e&&(r[e]=t[e]);r.audio_lost=new Object,r.audio_lost.L0=t.audio_lost,r.audio_lost.L1=0,r.audio_lost.L2=0,r.audio_lost.L3=0,r.audio_lost.L4=0,r.video_lost=new Object,r.video_lost.L0=t.video_lost,r.video_lost.L1=0,r.video_lost.L2=0,r.video_lost.L3=0,r.video_lost.L4=0,r.eventTime=(Date.now()/1e3).toFixed(0),r.ws0017="play_interval",r.url=g,r.playerId=R}}(I,e),n.events=new Array,n.events.push(e),e=JSON.stringify(n),k(),(c=new a._WSRangeSimpleLoader("POST",l)).__onComplete=k,c.__onError=k,n={url:_},c.__open(n,3,2,1,W(e))),X||(e=function(){var e,t;if(!(arguments.length<1))return e=arguments[0],t=(Date.now()/1e3).toFixed(0)+"\t",t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t+="bjweimiao\t")+P(R)+"\t")+P(R)+"\th5\t")+"rtc_player\t"+J+"\t")+(Date.now().toFixed(0)-b)+"\t")+P(g)+"\t")+function(){if(!arguments[0])return"-";var e=arguments[0],t=e.indexOf("://"),r=(t=-1==t?0:t+3,e.indexOf("/",t));return-1==r?e.substr(t):e.substr(t,r-t)}(g)+"\t")+e.first_show_time+"\t")+e.sdp_fail+"\t")+e.sdp_conn_times+"\t")+e.connect_succ+"\t")+e.connect_times+"\t")+e.buffer_times+"\t")+e.delay_time+"\t")+e.audio_delay_time+"\t")+e.video_recv_bytes+"\t")+e.audio_recv_bytes+"\t")+e.render_times+"\t")+e.video_first_pkt_delay+"\t")+e.audio_first_pkt_delay+"\t")+e.video_first_frame_delay+"\t")+e.video_jitter_delay+"\t")+e.audio_jitter_delay}(I),o=Math.round(Date.now()*(Math.random()+Math.random())/1e3).toString(16),t=Math.round(performance.now()).toString(16),r=Math.round(performance.now()*Math.random()*Math.random()*1e3).toString(16),i=Math.round((Date.now()/1e3+performance.now())*Math.random()).toString(16),o=(0,M.md5)(o+"-"+t+"-"+r+"-"+i+Date.now()),D(),(s=new a._WSRangeSimpleLoader("POST",l)).__onComplete=D,s.__onError=D,n={url:F+o},s.__open(n,3,2,1,W(e))),Q(),C.audio_jitter_delay_cnt=0,C.audio_delay_cnt=0,C.video_jitter_delay_cnt=0,C.delay_cnt=0}function W(e){if(!(arguments.length<1)){for(var t="wsPFVLive",r=e,i=r.length,o=new Uint8Array(i),n="",s=0;s<i;++s)o[s]=r.charCodeAt(s)^t.charCodeAt(s%t.length),n+=String.fromCharCode(o[s]);return o=null,n}}function Y(e){arguments.length<1||((e=e).eventCommon=new Object,e.eventCommon.Time=(Date.now()/1e3).toFixed(0),e.eventCommon.sType="rtc_player",e.eventCommon.ver=J,e.eventCommon.cid="bjweimiao",e.eventCommon.did=R,e.eventCommon.pTime=Date.now().toFixed(0)-b,e.eventCommon.sysinfo=x,e.eventCommon.platform="h5_rtc")}function P(e){return e||"-"}function K(e){if(!(d||Object.keys(w).length<=0)){var t,r=new Object,i=(r.events=new Array,Y(r),g.indexOf("?"));for(t in w){var o=new Object;o.event_time_msec=t,o.ws0017=1==w[t]?"open":"close",o.url=-1==i?g:g.substr(0,i),o.player_id=P(R),r.events.push(o)}var n=JSON.stringify(r),s=(null!=h&&(h.__onComplete=void 0,h.__onError=void 0,h.__destroy(),h=void 0),(h=new a._WSRangeSimpleLoader("POST",l)).__onComplete=k,h.__onError=k,{url:_});h.__open(s,3,2,1,W(n)),w=void 0,w=new Object}}},{"./env":7,"./md5":11,"./sha256":14,"./simple-loader":15}],14:[function(e,t,r){"use strict";function p(e,t){return t>>>e|t<<32-e}function u(e,t){return e[15&t]+=(p(17,r=e[t+14&15])^p(19,r)^r>>>10)+e[t+9&15]+(p(7,r=e[t+1&15])^p(18,r)^r>>>3);var r}Object.defineProperty(r,"__esModule",{value:!0}),r.sha256_digest=i;var v,h,m,f=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),y="0123456789abcdef";function I(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function C(){for(var e,t,r=new Array(16),i=v[0],o=v[1],n=v[2],s=v[3],a=v[4],_=v[5],d=v[6],l=v[7],c=0;c<16;c++)r[c]=m[3+(c<<2)]|m[2+(c<<2)]<<8|m[1+(c<<2)]<<16|m[c<<2]<<24;for(var h=0;h<64;h++)e=l+(p(6,a)^p(11,a)^p(25,a))+(a&_^~a&d)+f[h],e+=h<16?r[h]:u(r,h),t=(p(2,i)^p(13,i)^p(22,i))+(i&o^i&n^o&n),l=d,d=_,_=a,a=I(s,e),s=n,n=o,o=i,i=I(e,t);v[0]+=i,v[1]+=o,v[2]+=n,v[3]+=s,v[4]+=a,v[5]+=_,v[6]+=d,v[7]+=l}function i(e){v=new Array(8),h=new Array(2),m=new Array(64),h[0]=h[1]=0,v[0]=1779033703,v[1]=3144134277,v[2]=1013904242,v[3]=2773480762,v[4]=1359893119,v[5]=2600822924,v[6]=528734635,v[7]=1541459225;var t,r=e,i=e.length,o=0,n=h[0]>>3&63,s=63&i;for((h[0]+=i<<3)<i<<3&&h[1]++,h[1]+=i>>29,t=0;t+63<i;t+=64){for(var a=n;a<64;a++)m[a]=r.charCodeAt(o++);C(),n=0}for(a=0;a<s;a++)m[a]=r.charCodeAt(o++);e=h[0]>>3&63;if(m[e++]=128,e<=56)for(var _=e;_<56;_++)m[_]=0;else{for(_=e;_<64;_++)m[_]=0;C();for(_=0;_<56;_++)m[_]=0}m[56]=h[1]>>>24&255,m[57]=h[1]>>>16&255,m[58]=h[1]>>>8&255,m[59]=255&h[1],m[60]=h[0]>>>24&255,m[61]=h[0]>>>16&255,m[62]=h[0]>>>8&255,m[63]=255&h[0],C();for(var d=new String,l=0;l<8;l++)for(var c=28;0<=c;c-=4)d+=y.charAt(v[l]>>>c&15);return d}},{}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r._WSRangeSimpleLoader=void 0;var s=e("./loader"),i=e("./exception");class o extends s._WSBaseLoader{constructor(e,t,r){super("_WSRangeSimpleLoader"),this.TAG="_WSRangeSimpleLoader",this._method=e||"GET",this._dataSource=null,this._onRetry=null,this._data=null,this._headers=null,this._xhr=null,this._xhrTimeoutValue=t||2e3,this._contentLength=null,this._receivedLength=0,this._timeoutId=0,this._retryTime=0,this._retryDelay=0,this._retryRate=0,this._report=!1,this._flag=r}__destroy(){0!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0),this.__abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.ontimeout=null,this._xhr.abort(),this._xhr=null),this._dataSource=null,this._onRetry=null,this._data=null,this._headers=null,super.__destroy()}set __onRetry(e){this._onRetry=e}__open(e,t,r,i,o,n){this._retryTime=t,this._retryDelay=r,this._retryRate=i,this._dataSource=e,this._headers=n,this._status=s.LoaderStatus.kConnecting,o&&(this._data=o),0!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0),this._retryTime<1&&(this._retryTime=1),this.__internalOpen(n),this._report=!1}__internalOpen(e){if(null==this._xhr){let e=this._xhr=new XMLHttpRequest;e.timeout=this._xhrTimeoutValue,e.onreadystatechange=this.__onReadyStateChange.bind(this),e.onprogress=this.__onProgress.bind(this),e.onload=this.__onLoad.bind(this),e.onerror=this.__onXhrError.bind(this),e.ontimeout=this.__onTimeout.bind(this),e=void 0}if(this._xhr.open(this._method,this._dataSource.url,!0),"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&this._xhr.setRequestHeader(t,e[t]);try{this._xhr.send(this._data)}catch(e){}this._retryTime--}__abort(){this._status=s.LoaderStatus.kComplete,(this._contentLength=null)!=this._xhr&&this._xhr.abort()}__retry(){this.__internalOpen(this._headers)}__onReadyStateChange(e){e=e.target;if(2===e.readyState)if(200<=e.status&&e.status<=299)this._status=s.LoaderStatus.kBuffering;else if(this._status=s.LoaderStatus.kError,0!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0),0<this._retryTime)this._timeoutId=window.setTimeout(this.__retry.bind(this),Math.floor(this._retryDelay)),this._retryDelay*=this._retryRate,this._onRetry&&this._onRetry(e.status,this._xhr.responseURL);else{if(this._status=s.LoaderStatus.kIdle,!this._onError)throw new i.RuntimeException("http code invalid, "+e.status+" "+e.statusText);!1===this._report&&(this._report=!0,this._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText,url:this._xhr.responseURL}))}}__onProgress(e){this._status!==s.LoaderStatus.kError&&null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total)}__onLoad(e){if(this._status===s.LoaderStatus.kError)this._contentLength=null;else{if(200!==this._xhr.status&&304!==this._xhr.status||this._contentLength!==this._xhr.response.length&&"POST"!==this._method)return this._contentLength=null,0!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0),void(0<this._retryTime?(this._timeoutId=window.setTimeout(this.__retry.bind(this),Math.floor(this._retryDelay)),this._retryDelay*=this._retryRate,this._onRetry&&this._onRetry(this._xhr.status,this._xhr.responseURL)):(this._status=s.LoaderStatus.kIdle,this._onError&&!1===this._report&&(this._report=!0,this._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:this._xhr.status,msg:this._xhr.statusText,url:this._xhr.responseURL}))));let e="",t=this._xhr.getAllResponseHeaders(),r=(-1!==t.indexOf("hostname")&&(e=this._xhr.getResponseHeader("hostname")),this._xhr.response);this._onDataArrival&&this._onDataArrival(r,r.length,e),r=void 0,e=void 0,t=void 0,this._contentLength=null,this._status=s.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._xhr.status,this._xhr.responseURL)}}__onXhrError(e){if(0!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0),0<this._retryTime)return this._contentLength=null,this._timeoutId=window.setTimeout(this.__retry.bind(this),Math.floor(this._retryDelay)),this._retryDelay*=this._retryRate,e=void 0,void(this._onRetry&&this._onRetry(this._xhr.status,this._xhr.responseURL));this._status=s.LoaderStatus.kIdle;let t=0,r=null;if(r=this._contentLength&&0<this._receivedLength&&this._receivedLength<this._contentLength?(t=s.LoaderErrors.EARLY_EOF,{code:this._xhr.status,msg:"meet early EOF",url:this._xhr.responseURL}):(t=s.LoaderErrors.EXCEPTION,{code:this._xhr.status,msg:e.constructor.name+" "+e.type,url:this._xhr.responseURL}),this._contentLength=null,!this._onError)throw new i.RuntimeException(r.msg);!1===this._report&&(this._report=!0,this._onError(t,r)),t=void 0,r=void 0}__onTimeout(e){if(this._contentLength=null,0!=this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=0),0<this._retryTime&&"test"!==this._flag)return this._timeoutId=window.setTimeout(this.__retry.bind(this),Math.floor(this._retryDelay)),this._retryDelay*=this._retryRate,void(this._onRetry&&this._onRetry(this._xhr.status,this._xhr.responseURL));this._status=s.LoaderStatus.kIdle;let t=s.LoaderErrors.EXCEPTION,r={code:this._xhr.status,msg:"request timeout",url:this._xhr.responseURL};if(!this._onError)throw new i.RuntimeException(r.msg);!1===this._report&&(this._report=!0,this._onError(t,r)),t=void 0,r=void 0}}r._WSRangeSimpleLoader=o},{"./exception":8,"./loader":10}]},{},[9]);